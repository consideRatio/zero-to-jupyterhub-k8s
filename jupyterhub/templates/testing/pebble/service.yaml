{{- if .Values.testing.pebble.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: pebble
  labels:
    {{- include "jupyterhub.labels" . | nindent 4 }}
spec:
  type: ClusterIP
  selector:
    {{- include "jupyterhub.matchLabels" . | nindent 4 }}
  ports:
    - name: pebble-acme
      port: 14000
      targetPort: pebble-acme
    # The pebble REST api expose endpoints like /roots/0 and /roots-key/0 to get
    # the autogenerated root certificates used to provision certificates to the
    # ACME clients.
    - name: pebble-mgmt
      port: 15000
      targetPort: pebble-mgmt
    # The pebble challenge test server:
    # ref: https://github.com/letsencrypt/pebble/tree/master/cmd/pebble-challtestsrv
    - name: test-dns
      port: 8053
      targetPort: test-dns
    - name: test-mgmt
      port: 8055
      targetPort: test-mgmt
{{- end }}
